<template>
  <div if.bind="connecting">
    connecting to draft id ${draftCode}...
  </div>

  <div if.bind="connectionFailed">
    Connection failed, check code or draft is still running
  </div>

  <div if.bind="!connectionFailed && !connecting && draftState">
    <h3>Draft '${draftState.setup.name}' on map ${draftState.setup.mapName}</h3>
    <h3>Viewing as ${getDraftStateName()}</h3>

    <a href.bind="getViewingLink()" if.bind="draftState">Readonly viewing link</a>

    <div>
      Red team name: <strong>${draftState.setup.redName}</strong>
      Blue team name: <strong>${draftState.setup.blueName}</strong>
    </div>

    <div>Admin connected: ${snapshot.adminConnected ? 'TRUE' : 'FALSE'}</div>
    <div>red captain connected: ${snapshot.redConnected ? 'TRUE' : 'FALSE'}</div>
    <div>blue captain connected: ${snapshot.blueConnected ? 'TRUE' : 'FALSE'}</div>
    <div># viewers: ${snapshot.resultsViewers}</div>

    <div if.bind="!snapshot.draftDone && !snapshot.draftStarted">
      <div>Red captain ready: <strong>${snapshot.redReady ? 'YES' : 'NO' }</strong></div>
      <div>Blue captain ready: <strong>${snapshot.blueReady ? 'YES' : 'NO' }</strong></div>
      <h4>Drafting will begin when both captains are ready</h4>
    </div>

    <div if.bind="isCaptain() && !snapshot.draftStarted">
      <button class="btn btn-primary" click.trigger="sendReady()">Ready</button>
    </div>

    <div if.bind="snapshot.draftStarted && !snapshot.voteActive && !snapshot.draftDone">
      <h4>Pending next ban/pick... get ready</h4>
    </div>

    <div if.bind="snapshot.voteActive">
      <h4>VOTING ACTIVE!</h4>
      <h2>${snapshot.currentVote.phaseType == 'ban' ? 'BANNING' : 'PICKING'} ... </h2>

      <div if.bind="!snapshot.voteUnlimitedTime">
        <strong>${snapshot.voteTimeLeftPretty} seconds left .. ${snapshot.votePaused ? '(PAUSED)' : ''}</strong>
      </div>

      <div if.bind="isAdmin()">
        <button class="btn btn-warning" click.trigger="togglePauseTimer()">${snapshot.votePaused ? 'Unpause' : 'Pause'}
          vote
        </button>
        <button class="btn btn-danger" click.trigger="resetTimer()">Reset vote timer</button>
      </div>

      <div>Red vote locked in ${snapshot.currentVote.redHasVoted ? 'YES' : 'NO' }</div>
      <div>Blue vote locked in ${snapshot.currentVote.blueHasVoted ? 'YES' : 'NO' }</div>


      <form show.bind="isCaptain()">
        ${snapshot.currentVote.phaseType == 'ban' ? 'Banning' : 'Picking'} ...

        <div class="form-row">
          <select class="form-control form-group col-md-5 m-3" disabled.bind="!lockinEnabled && !snapshot.votePaused"
                  value.bind="selectedVoteValue">
            <option model.bind="none">Choose ..</option>
            <optgroup label="melee">
              <option disabled.bind="getChampDisabled(mc)" model.bind="mc.name" repeat.for="mc of validChampions.melee">
                ${mc.displayName}
              </option>
            </optgroup>
            <optgroup label="ranged">
              <option disabled.bind="getChampDisabled(mc)" model.bind="rc.name"
                      repeat.for="rc of validChampions.ranged">
                ${rc.displayName}
              </option>
            </optgroup>
            <optgroup label="support">
              <option disabled.bind="getChampDisabled(mc)" model.bind="sc.name"
                      repeat.for="sc of validChampions.support">
                ${sc.displayName}
              </option>
            </optgroup>
          </select>
          <button class="btn-lg btn-primary col-md-4 form-group m-3" click.trigger="lockinVote()"
                  disabled.bind="selectedVoteValue == 'none' || !lockinEnabled">
            Lock in
          </button>
        </div>
      </form>
    </div>

    <hr>

    <div>
      <h4>Draft selection ${snapshot.draftDone ? '(FINISHED)' : ''}</h4>
      <table class="table">
        <thead class="thead-light">
        <tr>
          <th scope="col">#</th>
          <th scope="col">Ban/pick</th>
          <th scope="col">Red (${draftState.setup.redName})</th>
          <th scope="col">Blue (${draftState.setup.blueName})</th>
          <th scope="col">Admin Adjusted?</th>
          <th if.bind="isAdmin()">Override</th>
        </tr>
        </thead>

        <tbody>

        <tr repeat.for="p of snapshot.phases">
          <th scope="row">${p.phaseNum + 1}</th>
          <td>${p.phaseType}</td>

          <td if.bind="!isAdmin()">${prettyVoteValue(p.voteRedValue) || 'None'}</td>
          <td if.bind="isAdmin()">
            <select value.bind="p.voteRedValue">
              <option model.bind="none">(none)</option>
              <optgroup label="melee">
                <option model.bind="mc.name" repeat.for="mc of champions.melee">${mc.displayName}</option>
              </optgroup>
              <optgroup label="ranged">
                <option model.bind="rc.name" repeat.for="rc of champions.ranged">${rc.displayName}</option>
              </optgroup>
              <optgroup label="support">
                <option model.bind="sc.name" repeat.for="sc of champions.support">${sc.displayName}</option>
              </optgroup>
            </select>
          </td>
          <td if.bind="!isAdmin()">${prettyVoteValue(p.voteBlueValue) || 'None'}</td>
          <td if.bind="isAdmin()">
            <select value.bind="p.voteBlueValue">
              <option model.bind="none">(none)</option>
              <optgroup label="melee">
                <option model.bind="mc.name" repeat.for="mc of champions.melee">${mc.displayName}</option>
              </optgroup>
              <optgroup label="ranged">
                <option model.bind="rc.name" repeat.for="rc of champions.ranged">${rc.displayName}</option>
              </optgroup>
              <optgroup label="support">
                <option model.bind="sc.name" repeat.for="sc of champions.support">${sc.displayName}</option>
              </optgroup>
            </select>
          </td>

          <td><input checked.bind="p.adminOverride" class="form-check-input" disabled="disabled" type="checkbox"></td>

          <td if.bind="isAdmin()">
            <button class="btn btn-danger" click.trigger="overrideVote(p)">Override vote</button>
          </td>
        </tr>
        </tbody>
      </table>
    </div>
  </div>
  </div>
</template>
