<template>
  <style>
    /* these are used in the results table colors */
    .red {
      color: #ba0000;
    }

    .blue {
      color: #0000c9;
    }

    .ban {
      background-color: rgba(225, 0, 0, 0.1);
    }

    .pick {
      background-color: rgba(0, 200, 0, 0.1);
    }

    .status-text {
      display: flex;
      flex-direction: row;
      justify-content: space-around;
    }

    .captain-status {
    }
  </style>

  <div if.bind="connecting">
    connecting to draft id ${draftCode}...
  </div>

  <div if.bind="connectionFailed">
    Connection failed, check code or draft is still running
  </div>

  <div if.bind="!connectionFailed && !connecting && draftState">
    <h4>Draft '${draftState.setup.name}' on map ${draftState.setup.mapName}</h4>
    <h5>Viewing as ${getDraftStateName()}</h5>
    <a href.bind="getViewingLink()" if.bind="draftState">Readonly viewing link</a>

    <div class="status-text">
      <div>Blue team name: <strong class="blue">${draftState.setup.blueName}</strong></div>
      <div>Red team name: <strong class="red">${draftState.setup.redName}</strong></div>
      <div>Admin connected: ${snapshot.adminConnected ? 'TRUE' : 'FALSE'}</div>
      <div>Red connected: ${snapshot.redConnected ? 'TRUE' : 'FALSE'}</div>
      <div>Blue connected: ${snapshot.blueConnected ? 'TRUE' : 'FALSE'}</div>
    </div>

    <div if.bind="!snapshot.draftDone && !snapshot.draftStarted">
      <div class="status-text">
        <div>Red captain ready: <strong>${snapshot.redReady ? 'YES' : 'NO' }</strong></div>
        <div>Blue captain ready: <strong>${snapshot.blueReady ? 'YES' : 'NO' }</strong></div>
      </div>
      <h5>Drafting will begin when both captains are ready</h5>
    </div>

    <div if.bind="isCaptain() && !snapshot.draftStarted">
      <button class="btn btn-primary" click.trigger="sendReady()">Ready</button>
    </div>

    <div if.bind="snapshot.draftStarted && !snapshot.voteActive && !snapshot.draftDone">
      <h4>Pending next ban/pick... get ready</h4>
    </div>

    <div if.bind="snapshot.voteActive">
      <h6>VOTING ACTIVE!</h6>
      <div if.bind="!snapshot.voteUnlimitedTime">
        <strong><span class.bind="snapshot.currentVote.phaseType">${snapshot.currentVote.phaseType == 'ban' ? 'BANNING' : 'PICKING'}</span>:
          ${snapshot.voteTimeLeftPretty} seconds left .. ${snapshot.votePaused ? '(PAUSED)' : ''}</strong>
      </div>

      <div if.bind="isAdmin()">
        <button class="btn btn-warning" click.trigger="togglePauseTimer()">${snapshot.votePaused ? 'Unpause' : 'Pause'}
          vote
        </button>
        <button class="btn btn-danger" click.trigger="resetTimer()">Reset vote timer</button>

        <div>Red vote locked in ${snapshot.currentVote.redHasVoted ? 'YES' : 'NO' }</div>
        <div>Blue vote locked in ${snapshot.currentVote.blueHasVoted ? 'YES' : 'NO' }</div>
      </div>

      <form show.bind="isCaptain()">

        <div class="form-row">
          <select class="form-control form-group col-md-5 m-3" disabled.bind="!lockinEnabled && !snapshot.votePaused"
                  value.bind="selectedVoteValue">
            <option model.bind="none">Choose ..</option>
            <optgroup label="melee">
              <option disabled.bind="getChampDisabled(mc)" model.bind="mc.name" repeat.for="mc of validChampions.melee">
                ${mc.displayName}
              </option>
            </optgroup>
            <optgroup label="ranged">
              <option disabled.bind="getChampDisabled(mc)" model.bind="rc.name"
                      repeat.for="rc of validChampions.ranged">
                ${rc.displayName}
              </option>
            </optgroup>
            <optgroup label="support">
              <option disabled.bind="getChampDisabled(mc)" model.bind="sc.name"
                      repeat.for="sc of validChampions.support">
                ${sc.displayName}
              </option>
            </optgroup>
          </select>
          <button class="btn-lg btn-primary col-md-4 form-group m-3" click.trigger="lockinVote()"
                  disabled.bind="selectedVoteValue == 'none' || !lockinEnabled">
            Lock in
          </button>
        </div>
      </form>
    </div>

    <hr>

    <div>
      <h4>Draft selection ${snapshot.draftDone ? '(FINISHED)' : ''}</h4>
      <table class="table table-sm">
        <thead class="thead-light">
        <tr>
          <th scope="col">#</th>
          <th scope="col">Ban/pick</th>
          <th scope="col">Blue (${draftState.setup.blueName})</th>
          <th scope="col">Red (${draftState.setup.redName})</th>
          <th scope="col">Admin Adjusted?</th>
          <th if.bind="isAdmin()">Override</th>
        </tr>
        </thead>

        <tbody>

        <tr repeat.for="p of snapshot.phases" class.bind="p.phaseType">
          <th scope="row">${p.phaseNum + 1}</th>
          <th scope="row">${p.phaseType}</th>

          <td if.bind="!isAdmin()"><strong>${prettyVoteValue(p.voteBlueValue) || 'None'}</strong></td>
          <td if.bind="isAdmin()">
            <select value.bind="p.voteBlueValue">
              <option model.bind="none">(none)</option>
              <optgroup label="melee">
                <option model.bind="mc.name" repeat.for="mc of champions.melee">${mc.displayName}</option>
              </optgroup>
              <optgroup label="ranged">
                <option model.bind="rc.name" repeat.for="rc of champions.ranged">${rc.displayName}</option>
              </optgroup>
              <optgroup label="support">
                <option model.bind="sc.name" repeat.for="sc of champions.support">${sc.displayName}</option>
              </optgroup>
            </select>
          </td>

          <td if.bind="!isAdmin()"><strong>${prettyVoteValue(p.voteRedValue) || 'None'}</strong></td>
          <td if.bind="isAdmin()">
            <select value.bind="p.voteRedValue">
              <option model.bind="none">(none)</option>
              <optgroup label="melee">
                <option model.bind="mc.name" repeat.for="mc of champions.melee">${mc.displayName}</option>
              </optgroup>
              <optgroup label="ranged">
                <option model.bind="rc.name" repeat.for="rc of champions.ranged">${rc.displayName}</option>
              </optgroup>
              <optgroup label="support">
                <option model.bind="sc.name" repeat.for="sc of champions.support">${sc.displayName}</option>
              </optgroup>
            </select>
          </td>

          <td><input checked.bind="p.adminOverride" class="form-check-input" disabled="disabled" type="checkbox"></td>

          <td if.bind="isAdmin()">
            <button class="btn btn-danger btn-sm" click.trigger="overrideVote(p)">Override vote</button>
          </td>
        </tr>
        </tbody>
      </table>
    </div>

    <div if.bind="snapshot && snapshot.draftDone">
      <a href.bind="getReportLink()" target="_blank">Generate Draft Report</a>
    </div>
  </div>
  </div>
</template>
